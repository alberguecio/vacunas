<html><head><base href="https://salmonevax.com/?">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SalmonVax - Sistema de Gestión de Vacunación</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(45deg, #0077be, #00a86b);
    }
    .container {
        background-color: rgba(255, 255, 255, 0.9);
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
        width: 90%;
        max-width: 800px;
    }
    h1, h2, h3 {
        color: #0077be;
        margin-bottom: 1rem;
    }
    form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    input, select, textarea {
        padding: 0.5rem;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
    button {
        background-color: #0077be;
        color: white;
        border: none;
        padding: 0.5rem;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    button:hover {
        background-color: #005f9e;
    }
    #error-message {
        color: red;
        margin-top: 1rem;
    }
    #dashboard, #user-management, #create-task, #reports-analysis, #operator-daily-input, #comprehensive-report {
        display: none;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 0.5rem;
        text-align: left;
    }
    th {
        background-color: #f2f2f2;
    }
</style>
</head>
<body>
<div class="container">
    <h1>SalmonVax</h1>
    <div id="login-form">
        <form onsubmit="return login()">
            <input type="text" id="username" placeholder="Usuario" required>
            <input type="password" id="password" placeholder="Contraseña" required>
            <button type="submit">Iniciar Sesión</button>
        </form>
        <p id="error-message"></p>
    </div>
    <div id="dashboard">
        <h2>Bienvenido, <span id="user-role"></span></h2>
        <div id="admin-panel" style="display: none;">
            <h3>Panel de Administrador</h3>
            <button onclick="showUserManagement()">Gestión de Usuarios</button>
            <button onclick="showCreateTask()">Crear Faena</button>
            <button onclick="showSpecificReport()">Informe Específico</button>
        </div>
        <div id="operator-panel" style="display: none;">
            <h3>Panel de Operario</h3>
            <button onclick="showOperatorDailyInput()">Registrar Actividad Diaria</button>
        </div>
        <div id="manager-panel" style="display: none;">
            <h3>Panel de Jefatura</h3>
            <button onclick="showComprehensiveReport()">Ver Informe Completo</button>
            <button onclick="showSpecificReport()">Informe Específico</button>
        </div>
        <button onclick="logout()">Cerrar Sesión</button>
    </div>
    <div id="user-management">
        <h2>Gestión de Usuarios</h2>
        <form id="new-user-form" onsubmit="return addUser()">
            <input type="text" id="new-username" placeholder="Nombre de usuario" required>
            <input type="password" id="new-password" placeholder="Contraseña" required>
            <input type="text" id="new-firstname" placeholder="Nombre" required>
            <input type="text" id="new-lastname" placeholder="Apellido" required>
            <input type="text" id="new-position" placeholder="Cargo" required>
            <select id="new-role" required>
                <option value="">Seleccione un rol</option>
                <option value="Administrador">Administrador</option>
                <option value="Operario">Operario</option>
                <option value="Jefatura">Jefatura</option>
            </select>
            <button type="submit">Agregar Usuario</button>
        </form>
        <table id="users-table">
            <thead>
                <tr>
                    <th>Usuario</th>
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>Cargo</th>
                    <th>Rol</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="users-list"></tbody>
        </table>
        <button onclick="backToDashboard()">Volver al Panel</button>
    </div>
    <div id="create-task">
        <h2>Crear Faena</h2>
        <form id="new-task-form" onsubmit="return addTask()">
            <input type="text" id="task-name" placeholder="Nombre de la faena" required>
            <input type="text" id="task-city" placeholder="Ciudad" required>
            <input type="text" id="task-manager" placeholder="Encargado" required>
            <input type="date" id="task-start-date" required>
            <input type="number" id="task-duration" placeholder="Duración (días hábiles)" required min="1">
            <button type="submit">Crear Faena</button>
        </form>
        <h3>Listado de Faenas</h3>
        <table id="tasks-table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Ciudad</th>
                    <th>Encargado</th>
                    <th>Fecha de Inicio</th>
                    <th>Duración (días hábiles)</th>
                    <th>Fecha de Término</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="tasks-list"></tbody>
        </table>
        <button onclick="backToDashboard()">Volver al Panel</button>
    </div>
    <div id="reports-analysis">
        <h2>Reportes y Análisis</h2>
        <h3>Informe Específico de Faena</h3>
        <select id="faena-select">
            <option value="">Seleccione una faena</option>
        </select>
        <button onclick="generateDetailedReport()">Generar Informe Específico</button>
        <div id="detailed-report"></div>
        
        <button onclick="backToDashboard()">Volver al Panel</button>
    </div>
    <div id="operator-daily-input">
        <h2>Registro de Actividad Diaria</h2>
        <form id="daily-input-form" onsubmit="return addDailyInput()">
            <select id="task-select" required onchange="displayTaskInfo()">
                <option value="">Seleccione una faena</option>
            </select>
            <div id="selected-task-info" style="display: none;">
                <h3>Información de la Faena</h3>
                <p><strong>Nombre:</strong> <span id="selected-task-name"></span></p>
                <p><strong>Fecha de inicio:</strong> <span id="selected-task-start"></span></p>
                <p><strong>Fecha de término:</strong> <span id="selected-task-end"></span></p>
                <p><strong>Duración:</strong> <span id="selected-task-duration"></span> días hábiles</p>
            </div>
            <input type="date" id="vaccination-date" required>
            <input type="text" id="sheet-number" placeholder="Número de planilla" required>
            <input type="number" id="vaccinated-salmon" placeholder="Salmones vacunados" required min="1">
            <input type="file" id="backup-image" accept="image/*">
            <button type="submit">Registrar Actividad</button>
        </form>
        <h3>Registro Diario</h3>
        <table id="daily-input-table">
            <thead>
                <tr>
                    <th>Fecha y Hora</th>
                    <th>Faena</th>
                    <th>Fecha de Vacunación</th>
                    <th>Número de Planilla</th>
                    <th>Salmones Vacunados</th>
                    <th>Imagen de Respaldo</th>
                </tr>
            </thead>
            <tbody id="daily-input-list"></tbody>
        </table>
        <button onclick="backToDashboard()">Volver al Panel</button>
    </div>
    <div id="comprehensive-report" style="display: none;">
        <h2>Informe Completo</h2>
        
        <h3>Información de Usuarios</h3>
        <table id="comprehensive-users-table">
            <thead>
                <tr>
                    <th>Usuario</th>
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>Cargo</th>
                    <th>Rol</th>
                </tr>
            </thead>
            <tbody id="comprehensive-users-list"></tbody>
        </table>

        <h3>Información de Faenas</h3>
        <table id="comprehensive-tasks-table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Ciudad</th>
                    <th>Encargado</th>
                    <th>Fecha de Inicio</th>
                    <th>Duración (días hábiles)</th>
                    <th>Fecha de Término</th>
                </tr>
            </thead>
            <tbody id="comprehensive-tasks-list"></tbody>
        </table>

        <button onclick="printComprehensiveReport()">Imprimir Informe Completo</button>
        <button onclick="backToDashboard()">Volver al Panel</button>
    </div>
</div>

<script>
// Datos de ejemplo
const users = [
    { username: 'admin1', password: '1234', firstname: 'Admin', lastname: 'User', position: 'Administrador General', role: 'Administrador' },
    { username: 'operador1', password: '1234', firstname: 'Operador', lastname: 'Uno', position: 'Operario de Campo', role: 'Operario' },
    { username: 'jefatura1', password: '1234', firstname: 'Jefe', lastname: 'Supervisor', position: 'Jefe de Operaciones', role: 'Jefatura' }
];

const tasks = [
    { name: 'Faena 1', city: 'Puerto Montt', manager: 'Juan Pérez', startDate: '2023-06-01', duration: 10, endDate: '2023-06-14' },
    { name: 'Faena 2', city: 'Chiloé', manager: 'María González', startDate: '2023-06-15', duration: 15, endDate: '2023-07-05' },
    { name: 'Faena 3', city: 'Aysén', manager: 'Carlos Rodríguez', startDate: '2023-07-10', duration: 20, endDate: '2023-08-07' }
];

const dailyInputs = [
    {
        datetime: '2023-06-01 09:00:00',
        task: 'Faena 1',
        vaccinationDate: '2023-06-01',
        sheetNumber: '001',
        vaccinatedSalmon: '1000',
        backupImage: 'https://example.com/images/faena1_001.jpg'
    },
    {
        datetime: '2023-06-02 10:30:00',
        task: 'Faena 1',
        vaccinationDate: '2023-06-02',
        sheetNumber: '002',
        vaccinatedSalmon: '1200',
        backupImage: 'https://example.com/images/faena1_002.jpg'
    },
    {
        datetime: '2023-06-15 08:45:00',
        task: 'Faena 2',
        vaccinationDate: '2023-06-15',
        sheetNumber: '001',
        vaccinatedSalmon: '800',
        backupImage: 'https://example.com/images/faena2_001.jpg'
    },
    {
        datetime: '2023-06-16 11:15:00',
        task: 'Faena 2',
        vaccinationDate: '2023-06-16',
        sheetNumber: '002',
        vaccinatedSalmon: '950',
        backupImage: 'https://example.com/images/faena2_002.jpg'
    }
];

let currentUser = null;

function login() {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const user = users.find(u => u.username === username && u.password === password);
    if (user) {
        currentUser = user;
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        document.getElementById('user-role').textContent = user.role;
        showUserPanel(user.role);
        return false;
    } else {
        document.getElementById('error-message').textContent = 'Usuario o contraseña incorrectos';
        return false;
    }
}

function showUserPanel(role) {
    document.getElementById('admin-panel').style.display = role === 'Administrador' ? 'block' : 'none';
    document.getElementById('operator-panel').style.display = role === 'Operario' ? 'block' : 'none';
    document.getElementById('manager-panel').style.display = role === 'Jefatura' ? 'block' : 'none';
}

function logout() {
    currentUser = null;
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('login-form').style.display = 'block';
    document.getElementById('username').value = '';
    document.getElementById('password').value = '';
    document.getElementById('error-message').textContent = '';
}

function showUserManagement() {
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('user-management').style.display = 'block';
    updateUsersList();
}

function updateUsersList() {
    const usersList = document.getElementById('users-list');
    usersList.innerHTML = '';
    users.forEach((user, index) => {
        const row = usersList.insertRow();
        row.insertCell(0).textContent = user.username;
        row.insertCell(1).textContent = user.firstname;
        row.insertCell(2).textContent = user.lastname;
        row.insertCell(3).textContent = user.position;
        row.insertCell(4).textContent = user.role;
        const actionsCell = row.insertCell(5);
        actionsCell.innerHTML = `
            <button onclick="editUser(${index})">Editar</button>
            <button onclick="deleteUser(${index})">Eliminar</button>
        `;
    });
}

function addUser() {
    const newUser = {
        username: document.getElementById('new-username').value,
        password: document.getElementById('new-password').value,
        firstname: document.getElementById('new-firstname').value,
        lastname: document.getElementById('new-lastname').value,
        position: document.getElementById('new-position').value,
        role: document.getElementById('new-role').value
    };
    users.push(newUser);
    updateUsersList();
    document.getElementById('new-user-form').reset();
    return false;
}

function editUser(index) {
    const user = users[index];
    document.getElementById('new-username').value = user.username;
    document.getElementById('new-password').value = user.password;
    document.getElementById('new-firstname').value = user.firstname;
    document.getElementById('new-lastname').value = user.lastname;
    document.getElementById('new-position').value = user.position;
    document.getElementById('new-role').value = user.role;

    const form = document.getElementById('new-user-form');
    form.onsubmit = function() { return updateUser(index); };

    const submitButton = form.querySelector('button[type="submit"]');
    submitButton.textContent = 'Actualizar Usuario';
}

function updateUser(index) {
    const updatedUser = {
        username: document.getElementById('new-username').value,
        password: document.getElementById('new-password').value,
        firstname: document.getElementById('new-firstname').value,
        lastname: document.getElementById('new-lastname').value,
        position: document.getElementById('new-position').value,
        role: document.getElementById('new-role').value
    };

    users[index] = updatedUser;
    updateUsersList();

    document.getElementById('new-user-form').reset();
    document.getElementById('new-user-form').onsubmit = function() { return addUser(); };
    const submitButton = document.getElementById('new-user-form').querySelector('button[type="submit"]');
    submitButton.textContent = 'Agregar Usuario';

    return false;
}

function deleteUser(index) {
    users.splice(index, 1);
    updateUsersList();
}

function showCreateTask() {
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('create-task').style.display = 'block';
    updateTasksList();
}

function updateTasksList() {
    const tasksList = document.getElementById('tasks-list');
    tasksList.innerHTML = '';
    tasks.forEach((task, index) => {
        const row = tasksList.insertRow();
        row.insertCell(0).textContent = task.name;
        row.insertCell(1).textContent = task.city;
        row.insertCell(2).textContent = task.manager;
        row.insertCell(3).textContent = task.startDate;
        row.insertCell(4).textContent = task.duration;
        row.insertCell(5).textContent = task.endDate;
        const actionsCell = row.insertCell(6);
        actionsCell.innerHTML = `
            <button onclick="editTask(${index})">Editar</button>
            <button onclick="deleteTask(${index})">Eliminar</button>
        `;
    });
}

function addTask() {
    const taskName = document.getElementById('task-name').value;
    const taskCity = document.getElementById('task-city').value;
    const taskManager = document.getElementById('task-manager').value;
    const taskStartDate = document.getElementById('task-start-date').value;
    const taskDuration = parseInt(document.getElementById('task-duration').value);
    const taskEndDate = calculateEndDate(taskStartDate, taskDuration);

    const newTask = {
        name: taskName,
        city: taskCity,
        manager: taskManager,
        startDate: taskStartDate,
        duration: taskDuration,
        endDate: taskEndDate
    };

    const editIndex = document.getElementById('new-task-form').getAttribute('data-edit-index');
    if (editIndex !== null) {
        tasks[editIndex] = newTask;
        document.getElementById('new-task-form').removeAttribute('data-edit-index');
    } else {
        tasks.push(newTask);
    }

    updateTasksList();
    document.getElementById('new-task-form').reset();
    document.querySelector('#new-task-form button[type="submit"]').textContent = 'Crear Faena';
    return false;
}

function editTask(index) {
    const task = tasks[index];
    document.getElementById('task-name').value = task.name;
    document.getElementById('task-city').value = task.city;
    document.getElementById('task-manager').value = task.manager;
    document.getElementById('task-start-date').value = task.startDate;
    document.getElementById('task-duration').value = task.duration;

    document.getElementById('new-task-form').setAttribute('data-edit-index', index);
    document.querySelector('#new-task-form button[type="submit"]').textContent = 'Actualizar Faena';
}

function deleteTask(index) {
    if (confirm('¿Está seguro de que desea eliminar esta faena?')) {
        tasks.splice(index, 1);
        updateTasksList();
    }
}

function showSpecificReport() {
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('reports-analysis').style.display = 'block';
    updateFaenaSelect();
}

function generateDetailedReport() {
    const faenaSelect = document.getElementById('faena-select');
    const selectedFaena = faenaSelect.value;
    if (!selectedFaena) {
        alert('Por favor seleccione una faena');
        return;
    }

    const faena = tasks.find(task => task.name === selectedFaena);
    const faenaInputs = dailyInputs.filter(input => input.task === selectedFaena);
    const totalVaccinated = faenaInputs.reduce((sum, input) => sum + parseInt(input.vaccinatedSalmon), 0);

    let reportHTML = `
        <h3>Informe Específico: ${faena.name}</h3>
        <p><strong>Ciudad:</strong> ${faena.city}</p>
        <p><strong>Encargado:</strong> ${faena.manager}</p>
        <p><strong>Fecha de Inicio:</strong> ${faena.startDate}</p>
        <p><strong>Fecha de Término:</strong> ${faena.endDate}</p>
        <p><strong>Duración:</strong> ${faena.duration} días hábiles</p>
        <p><strong>Total de Salmones Vacunados:</strong> ${totalVaccinated}</p>

        <h4>Detalle de Vacunación Diaria</h4>
        <table>
            <thead>
                <tr>
                    <th>Fecha y Hora</th>
                    <th>Fecha de Vacunación</th>
                    <th>Número de Planilla</th>
                    <th>Salmones Vacunados</th>
                    <th>Imagen de Respaldo</th>
                </tr>
            </thead>
            <tbody>
    `;

    faenaInputs.forEach(input => {
        reportHTML += `
            <tr>
                <td>${input.datetime}</td>
                <td>${input.vaccinationDate}</td>
                <td>${input.sheetNumber}</td>
                <td>${input.vaccinatedSalmon}</td>
                <td>${input.backupImage ? `<a href="${input.backupImage}" target="_blank">Ver imagen</a>` : 'No disponible'}</td>
            </tr>
        `;
    });

    reportHTML += `
            </tbody>
        </table>
    `;

    document.getElementById('detailed-report').innerHTML = reportHTML;
}

function updateFaenaSelect() {
    const faenaSelect = document.getElementById('faena-select');
    faenaSelect.innerHTML = '<option value="">Seleccione una faena</option>';
    tasks.forEach(task => {
        const option = document.createElement('option');
        option.value = task.name;
        option.textContent = task.name;
        faenaSelect.appendChild(option);
    });
}

function printReport(reportType) {
}

function showOperatorDailyInput() {
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('operator-daily-input').style.display = 'block';
    updateTaskSelect();
    updateDailyInputList();
    document.getElementById('selected-task-info').style.display = 'none';
}

function updateTaskSelect() {
    const taskSelect = document.getElementById('task-select');
    taskSelect.innerHTML = '<option value="">Seleccione una faena</option>';
    tasks.forEach(task => {
        const option = document.createElement('option');
        option.value = task.name;
        option.textContent = task.name;
        taskSelect.appendChild(option);
    });
}

function displayTaskInfo() {
    const taskSelect = document.getElementById('task-select');
    const selectedTaskInfo = document.getElementById('selected-task-info');
    const selectedTaskName = document.getElementById('selected-task-name');
    const selectedTaskStart = document.getElementById('selected-task-start');
    const selectedTaskEnd = document.getElementById('selected-task-end');
    const selectedTaskDuration = document.getElementById('selected-task-duration');

    if (taskSelect.value) {
        const selectedTask = tasks.find(task => task.name === taskSelect.value);
        if (selectedTask) {
            selectedTaskName.textContent = selectedTask.name;
            selectedTaskStart.textContent = selectedTask.startDate;
            selectedTaskEnd.textContent = selectedTask.endDate;
            selectedTaskDuration.textContent = selectedTask.duration;
            selectedTaskInfo.style.display = 'block';
        } else {
            selectedTaskInfo.style.display = 'none';
        }
    } else {
        selectedTaskInfo.style.display = 'none';
    }
}

function addDailyInput() {
    const newInput = {
        datetime: new Date().toLocaleString(),
        task: document.getElementById('task-select').value,
        vaccinationDate: document.getElementById('vaccination-date').value,
        sheetNumber: document.getElementById('sheet-number').value,
        vaccinatedSalmon: document.getElementById('vaccinated-salmon').value,
        backupImage: document.getElementById('backup-image').files[0] ? document.getElementById('backup-image').files[0].name : 'No image'
    };
    dailyInputs.push(newInput);
    updateDailyInputList();
    document.getElementById('daily-input-form').reset();
    return false;
}

function updateDailyInputList() {
    const dailyInputList = document.getElementById('daily-input-list');
    dailyInputList.innerHTML = '';
    dailyInputs.forEach(input => {
        const row = dailyInputList.insertRow();
        row.insertCell(0).textContent = input.datetime;
        row.insertCell(1).textContent = input.task;
        row.insertCell(2).textContent = input.vaccinationDate;
        row.insertCell(3).textContent = input.sheetNumber;
        row.insertCell(4).textContent = input.vaccinatedSalmon;
        row.insertCell(5).textContent = input.backupImage;
    });
}

function backToDashboard() {
    document.getElementById('user-management').style.display = 'none';
    document.getElementById('create-task').style.display = 'none';
    document.getElementById('reports-analysis').style.display = 'none';
    document.getElementById('operator-daily-input').style.display = 'none';
    document.getElementById('comprehensive-report').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';
}

function reviewData() {
    showComprehensiveReport();
}

function showComprehensiveReport() {
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('comprehensive-report').style.display = 'block';
    updateComprehensiveReport();
}

function updateComprehensiveReport() {
    updateComprehensiveUsersList();
    updateComprehensiveTasksList();
}

function updateComprehensiveUsersList() {
    const usersList = document.getElementById('comprehensive-users-list');
    usersList.innerHTML = '';
    users.forEach(user => {
        const row = usersList.insertRow();
        row.insertCell(0).textContent = user.username;
        row.insertCell(1).textContent = user.firstname;
        row.insertCell(2).textContent = user.lastname;
        row.insertCell(3).textContent = user.position;
        row.insertCell(4).textContent = user.role;
    });
}

function updateComprehensiveTasksList() {
    const tasksList = document.getElementById('comprehensive-tasks-list');
    tasksList.innerHTML = '';
    tasks.forEach(task => {
        const row = tasksList.insertRow();
        row.insertCell(0).textContent = task.name;
        row.insertCell(1).textContent = task.city;
        row.insertCell(2).textContent = task.manager;
        row.insertCell(3).textContent = task.startDate;
        row.insertCell(4).textContent = task.duration;
        row.insertCell(5).textContent = task.endDate;
    });
}

function printComprehensiveReport() {
    const reportWindow = window.open('', '_blank');
    reportWindow.document.write('<html><head><title>Informe Completo</title>');
    reportWindow.document.write('<style>table { border-collapse: collapse; width: 100%; margin-bottom: 20px; } th, td { border: 1px solid black; padding: 8px; text-align: left; }</style>');
    reportWindow.document.write('</head><body>');
    reportWindow.document.write('<h1>Informe Completo</h1>');
    reportWindow.document.write(document.getElementById('comprehensive-report').innerHTML);
    reportWindow.document.write('</body></html>');
    reportWindow.document.close();
    reportWindow.print();
}
</script>
</body>
</html>